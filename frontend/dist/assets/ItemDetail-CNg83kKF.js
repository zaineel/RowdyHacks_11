import{r as u,p as m,e as j,c as d,f as b,a as t,t as a,n as E,w as M,i as f,v as g,l as U,j as x,q as V,d as N,o as n}from"./index-UQSIJfrq.js";const O={key:0,class:"text-center py-12"},z={key:1,class:"max-w-4xl mx-auto"},L={class:"card"},P={class:"flex items-start justify-between mb-6"},A={class:"flex items-center space-x-4"},Y={class:"text-6xl"},G={class:"text-3xl font-bold text-frontier-400"},H={class:"text-dusty-400"},J={class:"mb-6"},K={class:"text-dusty-300"},Q={class:"grid md:grid-cols-3 gap-6 mb-6"},W={class:"card bg-dusty-700"},X={class:"text-2xl font-bold text-frontier-400"},Z={class:"card bg-dusty-700"},tt={class:"text-2xl font-bold text-starlight-400"},et={class:"card bg-dusty-700"},st={class:"text-2xl font-bold text-cosmic-400 capitalize"},ot={class:"text-xs text-dusty-400 mt-1"},at={class:"card bg-dusty-700 mb-6"},lt={class:"flex items-center justify-between"},rt={class:"text-dusty-100 font-medium"},dt={class:"text-sm text-dusty-400"},nt={class:"text-right"},it={class:"text-xl font-bold text-frontier-400"},ut={key:0,class:"card bg-dusty-700"},ct={key:0,class:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-4"},mt={class:"text-sm text-dusty-300 mt-1"},vt={class:"grid md:grid-cols-2 gap-4 mb-4"},bt=["min","disabled"],xt=["min","disabled"],_t={class:"mb-4"},pt=["disabled"],yt={key:0,class:"bg-frontier-500/10 border border-frontier-500/30 rounded-lg p-4 mb-4"},ft={class:"flex justify-between items-center mb-2"},gt={class:"font-bold text-dusty-100"},wt={class:"flex justify-between items-center mb-2"},ht={class:"text-dusty-300"},kt={class:"font-bold text-dusty-100"},Dt={class:"flex justify-between items-center pt-2 border-t border-frontier-500/30"},qt={class:"text-frontier-400 font-bold text-xl"},Rt=["disabled"],Ct={key:0,class:"spinner inline-block mr-2"},It={key:1,class:"flex gap-3"},St={key:2,class:"card bg-yellow-500/10 border border-yellow-500/30"},$t={__name:"ItemDetail",setup(Bt){const w=V(),v=N(),_=u(!0),i=u(!1),s=u(null),p=u(null),y=u(500),l=u({start_date:"",end_date:"",notes:""}),h=m(()=>new Date().toISOString().split("T")[0]),k=m(()=>s.value&&p.value&&s.value.owner_id===p.value),D=m(()=>{if(!l.value.start_date||!l.value.end_date)return 0;const o=new Date(l.value.start_date),e=new Date(l.value.end_date);return Math.ceil((e-o)/(1e3*60*60*24))}),q=m(()=>s.value?D.value*s.value.daily_rate:0),R=m(()=>s.value?parseFloat(s.value.deposit_amount)+q.value:0),C=async()=>{_.value=!0;try{const o=await x.auth.getCurrentUser();p.value=o.data.data.id,y.value=o.data.data.credit_score||500;const e=await x.marketplace.getById(w.params.id);s.value=e.data.data}catch(o){console.error("Error loading item:",o),alert("Failed to load item details."),v.push("/marketplace")}finally{_.value=!1}},I=async()=>{var o,e,r;i.value=!0;try{await x.marketplace.requestBorrow(w.params.id,{borrow_start_date:l.value.start_date,borrow_end_date:l.value.end_date,notes:l.value.notes}),alert("Borrow request sent successfully! The owner will be notified."),v.push("/marketplace/my-dashboard")}catch(c){console.error("Error requesting borrow:",c),alert(((r=(e=(o=c.response)==null?void 0:o.data)==null?void 0:e.error)==null?void 0:r.message)||"Failed to send borrow request. Please try again.")}finally{i.value=!1}},S=()=>{v.push(`/marketplace/edit/${s.value.id}`)},B=async()=>{var o,e,r;if(confirm("Are you sure you want to delete this item? This action cannot be undone."))try{await x.marketplace.delete(s.value.id),alert("Item deleted successfully!"),v.push("/marketplace")}catch(c){console.error("Error deleting item:",c),alert(((r=(e=(o=c.response)==null?void 0:o.data)==null?void 0:e.error)==null?void 0:r.message)||"Failed to delete item.")}},T=o=>{const e={tools:"ðŸ”§",electronics:"ðŸ’»",books:"ðŸ“š",sports:"âš½",household:"ðŸ ",other:"ðŸ“¦"};return e[o]||e.other},$=o=>({available:"badge-success",borrowed:"badge-warning",unavailable:"badge-danger"})[o]||"badge",F=o=>new Date(o).toLocaleDateString("en-US",{month:"short",year:"numeric"});return j(async()=>{await C()}),(o,e)=>(n(),d("div",null,[_.value?(n(),d("div",O,[...e[4]||(e[4]=[t("div",{class:"spinner mx-auto"},null,-1)])])):s.value?(n(),d("div",z,[t("button",{onClick:e[0]||(e[0]=r=>o.$router.push("/marketplace")),class:"text-frontier-400 hover:text-frontier-300 mb-6"}," â† Back to Marketplace "),t("div",L,[t("div",P,[t("div",A,[t("div",Y,a(T(s.value.category)),1),t("div",null,[t("h1",G,a(s.value.title),1),t("p",H,a(s.value.category),1)])]),t("span",{class:E([$(s.value.status),"text-lg"])},a(s.value.status),3)]),t("div",J,[e[5]||(e[5]=t("h2",{class:"text-lg font-semibold text-frontier-400 mb-2"},"Description",-1)),t("p",K,a(s.value.description||"No description provided"),1)]),t("div",Q,[t("div",W,[e[6]||(e[6]=t("div",{class:"text-sm text-dusty-400 mb-1"},"Deposit Required",-1)),t("div",X,"$"+a(s.value.deposit_amount),1),e[7]||(e[7]=t("div",{class:"text-xs text-dusty-400 mt-1"},"Refundable",-1))]),t("div",Z,[e[8]||(e[8]=t("div",{class:"text-sm text-dusty-400 mb-1"},"Daily Rate",-1)),t("div",tt,a(s.value.daily_rate>0?`$${s.value.daily_rate}`:"Free"),1),e[9]||(e[9]=t("div",{class:"text-xs text-dusty-400 mt-1"},"Per day",-1))]),t("div",et,[e[10]||(e[10]=t("div",{class:"text-sm text-dusty-400 mb-1"},"Condition",-1)),t("div",st,a(s.value.condition),1),t("div",ot,a(s.value.total_borrows||0)+" times borrowed",1)])]),t("div",at,[e[12]||(e[12]=t("h3",{class:"text-lg font-semibold text-frontier-400 mb-3"},"Owner Information",-1)),t("div",lt,[t("div",null,[t("p",rt,a(s.value.owner_name),1),t("p",dt,"Member since "+a(F(s.value.created_at)),1)]),t("div",nt,[e[11]||(e[11]=t("div",{class:"text-sm text-dusty-400"},"Credit Score",-1)),t("div",it,a(s.value.owner_credit_score),1)])])]),!k.value&&s.value.status==="available"?(n(),d("div",ut,[e[20]||(e[20]=t("h3",{class:"text-lg font-semibold text-frontier-400 mb-4"},"Request to Borrow",-1)),y.value<s.value.min_credit_score?(n(),d("div",ct,[e[13]||(e[13]=t("p",{class:"text-red-400 font-medium"},"âš ï¸ Credit Score Too Low",-1)),t("p",mt," Required: "+a(s.value.min_credit_score)+" | Your score: "+a(y.value),1)])):(n(),d("form",{key:1,onSubmit:M(I,["prevent"])},[t("div",vt,[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-2"},"Start Date",-1)),f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>l.value.start_date=r),type:"date",required:"",min:h.value,class:"input-field",disabled:i.value},null,8,bt),[[g,l.value.start_date]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-2"},"End Date",-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>l.value.end_date=r),type:"date",required:"",min:l.value.start_date||h.value,class:"input-field",disabled:i.value},null,8,xt),[[g,l.value.end_date]])])]),t("div",_t,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium mb-2"},"Notes (Optional)",-1)),f(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=r=>l.value.notes=r),rows:"3",placeholder:"Tell the owner why you need this item...",class:"input-field resize-none",disabled:i.value},null,8,pt),[[g,l.value.notes]])]),R.value?(n(),d("div",yt,[t("div",ft,[e[17]||(e[17]=t("span",{class:"text-dusty-300"},"Deposit:",-1)),t("span",gt,"$"+a(s.value.deposit_amount),1)]),t("div",wt,[t("span",ht,"Rental ("+a(D.value)+" days):",1),t("span",kt,"$"+a(q.value),1)]),t("div",Dt,[e[18]||(e[18]=t("span",{class:"text-frontier-400 font-bold"},"Total:",-1)),t("span",qt,"$"+a(R.value),1)]),e[19]||(e[19]=t("p",{class:"text-xs text-dusty-400 mt-2"},"Deposit will be refunded when item is returned in good condition",-1))])):b("",!0),t("button",{type:"submit",class:"btn-frontier w-full",disabled:i.value||!l.value.start_date||!l.value.end_date},[i.value?(n(),d("span",Ct)):b("",!0),U(" "+a(i.value?"Sending Request...":"Request to Borrow"),1)],8,Rt)],32))])):k.value?(n(),d("div",It,[t("button",{onClick:S,class:"btn-frontier-outline flex-1"}," Edit Item "),t("button",{onClick:B,class:"flex-1 px-6 py-3 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-all duration-200"}," Delete Item ")])):s.value.status==="borrowed"?(n(),d("div",St,[...e[21]||(e[21]=[t("p",{class:"text-yellow-400"},"This item is currently borrowed by someone else.",-1)])])):b("",!0)])])):b("",!0)]))}};export{$t as default};
