import{u as D,r as d,e as F,l as U,k as c,c as i,a as e,f as h,t as o,n as x,F as S,h as V,o as l}from"./index-D9r3Di3t.js";const L={key:0,class:"text-center py-12"},N={key:1},T={class:"flex justify-between items-start mb-8"},z={class:"text-3xl font-bold text-frontier-400 mb-2"},Y={class:"text-dusty-300"},q={class:"grid md:grid-cols-4 gap-6 mb-8"},G={class:"card"},H={class:"text-3xl font-bold text-frontier-400"},J={class:"card"},K={class:"text-3xl font-bold text-starlight-400"},O={class:"card"},Q={class:"text-3xl font-bold text-cosmic-400"},W={class:"card"},X={class:"text-lg font-bold text-green-400"},Z={class:"card mb-8 bg-starlight-900/20 border-starlight-700"},ee={class:"flex justify-between items-center"},te={class:"text-2xl font-mono font-bold"},se={class:"mb-6 border-b border-dusty-700"},ae={class:"flex space-x-6"},oe={key:0,class:"card"},re={class:"space-y-3"},ne={class:"flex items-center space-x-3"},ie={class:"w-10 h-10 bg-frontier-500 rounded-full flex items-center justify-center text-white font-bold"},le={class:"font-medium"},ce={class:"text-sm text-dusty-400"},de={class:"flex items-center space-x-3"},ue=["onClick","disabled"],ve={key:1,class:"text-xs px-3 py-1 rounded bg-frontier-500/20 text-frontier-400 border border-frontier-500"},me=["onClick","disabled"],pe={key:1,class:"card"},_e={class:"space-y-2"},he={class:"flex items-center space-x-3"},ye={class:"text-2xl"},xe={class:"font-medium"},be={class:"text-sm text-dusty-400"},fe={class:"text-right"},ge={class:"font-bold text-frontier-400"},we={class:"text-xs text-dusty-400"},ke={key:2,class:"card"},Re={__name:"CircleDetail",setup(Ce){const m=U(),{user:Me}=D(),u=d("members"),k=d(!1),b=d(!1),f=d(!1),C=d(null),$=d(!1),n=d({name:"",description:"",status:"pending",monthly_amount:0,current_members:0,max_members:0,current_cycle:1,next_payout_date:null,invite_code:""}),g=d([]),M=d([]),y=d(new Map),E=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"}),j=()=>{navigator.clipboard.writeText(n.value.invite_code),alert("Invite code copied to clipboard!")},I=async r=>{var t,s,a,v,p,w,R,P;if(confirm(`Vouch for ${r.name}? This will help them get approved to join the circle.`)){b.value=!0;try{await c.vouches.create({circle_id:m.params.id,vouchee_id:r.user_id,trust_level:5,notes:`Vouched for ${r.name}`}),y.value.set(r.user_id,!0),alert(`Successfully vouched for ${r.name}!`);const _=await c.circles.getMembers(m.params.id);g.value=_.data.data}catch(_){if(console.error("Error vouching for member:",_),((t=_.response)==null?void 0:t.status)===409||(p=(v=(a=(s=_.response)==null?void 0:s.data)==null?void 0:a.error)==null?void 0:v.message)!=null&&p.includes("already"))y.value.set(r.user_id,!0),alert(`You have already vouched for ${r.name}!`);else{const B=((P=(R=(w=_.response)==null?void 0:w.data)==null?void 0:R.error)==null?void 0:P.message)||"Failed to vouch for member. Please try again.";alert(B)}}finally{b.value=!1}}},A=async r=>{var t,s,a;if(confirm(`Approve ${r.name} to join the circle?`)){f.value=!0;try{await c.circles.approveMember(m.params.id,r.user_id),alert(`${r.name} has been approved and is now an active member!`);const v=await c.circles.getById(m.params.id);n.value=v.data.data;const p=await c.circles.getMembers(m.params.id);g.value=p.data.data;const w=await c.circles.getSchedule(m.params.id);M.value=w.data.data}catch(v){console.error("Error approving member:",v);const p=((a=(s=(t=v.response)==null?void 0:t.data)==null?void 0:s.error)==null?void 0:a.message)||"Failed to approve member. Please try again.";alert(p)}finally{f.value=!1}}};return F(async()=>{const r=m.params.id;k.value=!0;try{const t=await c.auth.getCurrentUser();C.value=t.data.data.id;const s=await c.circles.getById(r);n.value=s.data.data,$.value=n.value.admin_id===C.value;try{const a=await c.circles.getMembers(r);g.value=a.data.data}catch(a){console.error("Error loading members:",a)}try{const a=await c.circles.getSchedule(r);M.value=a.data.data}catch(a){console.error("Error loading schedule:",a)}try{(await c.vouches.getMyVouches(r)).data.data.forEach(v=>{y.value.set(v.vouchee_id,!0)})}catch(a){console.error("Error loading vouches:",a)}}catch(t){console.error("Error loading circle:",t),alert("Failed to load circle details. Please try again.")}finally{k.value=!1}}),(r,t)=>(l(),i("div",null,[k.value?(l(),i("div",L,[...t[3]||(t[3]=[e("div",{class:"spinner mx-auto"},null,-1),e("p",{class:"text-dusty-300 mt-4"},"Loading circle details...",-1)])])):(l(),i("div",N,[e("div",T,[e("div",null,[e("h1",z,o(n.value.name),1),e("p",Y,o(n.value.description),1)]),e("span",{class:x(`badge-${n.value.status==="active"?"success":"warning"}`)},o(n.value.status),3)]),e("div",q,[e("div",G,[t[4]||(t[4]=e("div",{class:"text-dusty-400 text-sm mb-1"},"Monthly Amount",-1)),e("div",H,"$"+o(n.value.monthly_amount),1)]),e("div",J,[t[5]||(t[5]=e("div",{class:"text-dusty-400 text-sm mb-1"},"Members",-1)),e("div",K,o(n.value.current_members)+"/"+o(n.value.max_members),1)]),e("div",O,[t[6]||(t[6]=e("div",{class:"text-dusty-400 text-sm mb-1"},"Current Cycle",-1)),e("div",Q,o(n.value.current_cycle),1)]),e("div",W,[t[7]||(t[7]=e("div",{class:"text-dusty-400 text-sm mb-1"},"Next Payout",-1)),e("div",X,o(E(n.value.next_payout_date)),1)])]),e("div",Z,[e("div",ee,[e("div",null,[t[8]||(t[8]=e("h3",{class:"font-semibold text-starlight-400 mb-1"},"Invite Code",-1)),e("p",te,o(n.value.invite_code),1)]),e("button",{class:"btn-starlight",onClick:j}," Copy Code ")])]),e("div",se,[e("div",ae,[e("button",{class:x([u.value==="members"?"border-frontier-500 text-frontier-400":"border-transparent text-dusty-400","pb-3 border-b-2 font-medium transition-colors"]),onClick:t[0]||(t[0]=s=>u.value="members")}," Members ",2),e("button",{class:x([u.value==="schedule"?"border-frontier-500 text-frontier-400":"border-transparent text-dusty-400","pb-3 border-b-2 font-medium transition-colors"]),onClick:t[1]||(t[1]=s=>u.value="schedule")}," Payout Schedule ",2),e("button",{class:x([u.value==="payments"?"border-frontier-500 text-frontier-400":"border-transparent text-dusty-400","pb-3 border-b-2 font-medium transition-colors"]),onClick:t[2]||(t[2]=s=>u.value="payments")}," Payments ",2)])]),u.value==="members"?(l(),i("div",oe,[t[9]||(t[9]=e("h3",{class:"text-xl font-semibold mb-4 text-frontier-400"},"Circle Members",-1)),e("div",re,[(l(!0),i(S,null,V(g.value,s=>(l(),i("div",{key:s.id,class:"flex items-center justify-between p-3 bg-dusty-700 rounded-lg"},[e("div",ne,[e("div",ie,o(s.name.charAt(0)),1),e("div",null,[e("p",le,o(s.name),1),e("p",ce,"Credit Score: "+o(s.credit_score),1)])]),e("div",de,[e("span",{class:x(`badge-${s.status==="active"?"success":"warning"}`)},o(s.status),3),s.status==="pending"&&s.user_id!==C.value&&!y.value.has(s.user_id)?(l(),i("button",{key:0,onClick:a=>I(s),class:"btn-frontier text-sm",disabled:b.value},o(b.value?"Vouching...":"Vouch"),9,ue)):h("",!0),s.status==="pending"&&y.value.has(s.user_id)?(l(),i("span",ve," ✓ Vouched ")):h("",!0),s.status==="pending"&&$.value?(l(),i("button",{key:2,onClick:a=>A(s),class:"btn-starlight text-sm ml-2",disabled:f.value},o(f.value?"Approving...":"Approve"),9,me)):h("",!0)])]))),128))])])):h("",!0),u.value==="schedule"?(l(),i("div",pe,[t[10]||(t[10]=e("h3",{class:"text-xl font-semibold mb-4 text-frontier-400"},"Payout Schedule",-1)),e("div",_e,[(l(!0),i(S,null,V(M.value,(s,a)=>(l(),i("div",{key:a,class:"flex items-center justify-between p-3 bg-dusty-700 rounded-lg"},[e("div",he,[e("span",ye,o(s.has_received_payout?"✅":s.position_in_cycle===n.value.current_cycle?"➡️":"⏳"),1),e("div",null,[e("p",xe,o(s.user_name),1),e("p",be,"Position "+o(s.position_in_cycle),1)])]),e("div",fe,[e("p",ge,"$"+o(s.monthly_amount*n.value.current_members),1),e("p",we,o(s.has_received_payout?"Received":"Pending"),1)])]))),128))])])):h("",!0),u.value==="payments"?(l(),i("div",ke,[...t[11]||(t[11]=[e("h3",{class:"text-xl font-semibold mb-4 text-frontier-400"},"Recent Payments",-1),e("div",{class:"text-center py-8 text-dusty-400"}," Payment history coming soon... ",-1)])])):h("",!0)]))]))}};export{Re as default};
